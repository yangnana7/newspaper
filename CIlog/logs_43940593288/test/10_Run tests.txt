2025-08-21T13:38:15.3067221Z ##[group]Run # Limit collection to repo tests to avoid duplicate names in docs/ci_pack
2025-08-21T13:38:15.3067787Z [36;1m# Limit collection to repo tests to avoid duplicate names in docs/ci_pack[0m
2025-08-21T13:38:15.3068166Z [36;1mPYTHONPATH=. pytest -q tests[0m
2025-08-21T13:38:15.3109899Z shell: /usr/bin/bash -e {0}
2025-08-21T13:38:15.3110125Z env:
2025-08-21T13:38:15.3110574Z   DATABASE_URL: ***localhost:5432/testdb
2025-08-21T13:38:15.3110821Z   EMBED_SPACE: bge-m3
2025-08-21T13:38:15.3111016Z   ENABLE_SERVER_EMBEDDING: 0
2025-08-21T13:38:15.3111278Z   pythonLocation: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-21T13:38:15.3111672Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib/pkgconfig
2025-08-21T13:38:15.3112349Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-21T13:38:15.3112697Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-21T13:38:15.3113043Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-21T13:38:15.3113371Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib
2025-08-21T13:38:15.3113675Z ##[endgroup]
2025-08-21T13:38:28.0517661Z ....F.                                                                   [100%]
2025-08-21T13:38:28.0518333Z =================================== FAILURES ===================================
2025-08-21T13:38:28.0518943Z ________________________ test_semantic_search_fallback _________________________
2025-08-21T13:38:28.0519429Z 
2025-08-21T13:38:28.0519637Z     def test_semantic_search_fallback():
2025-08-21T13:38:28.0520057Z         from mcp_news import server
2025-08-21T13:38:28.0520524Z >       res = server.semantic_search("anything", top_k=5)
2025-08-21T13:38:28.0521099Z               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T13:38:28.0521412Z 
2025-08-21T13:38:28.0521579Z tests/test_smoke.py:50: 
2025-08-21T13:38:28.0522010Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-21T13:38:28.0522541Z mcp_news/server.py:135: in semantic_search
2025-08-21T13:38:28.0523008Z     cur = conn.execute(
2025-08-21T13:38:28.0523372Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-21T13:38:28.0523695Z 
2025-08-21T13:38:28.0523878Z self = <psycopg.Connection [BAD] at 0x7f15b59ee490>
2025-08-21T13:38:28.0525334Z query = '\n            SELECT d.doc_id, d.title_raw, d.published_at,\n                   (SELECT val FROM hint WHERE doc_id=d....on\n            FROM doc d\n            \n            ORDER BY d.published_at DESC\n            LIMIT %s\n            '
2025-08-21T13:38:28.0526487Z params = (5,)
2025-08-21T13:38:28.0526652Z 
2025-08-21T13:38:28.0526757Z     def execute(
2025-08-21T13:38:28.0527083Z         self,
2025-08-21T13:38:28.0527379Z         query: Query,
2025-08-21T13:38:28.0527679Z         params: Params | None = None,
2025-08-21T13:38:28.0528017Z         *,
2025-08-21T13:38:28.0528291Z         prepare: bool | None = None,
2025-08-21T13:38:28.0528635Z         binary: bool = False,
2025-08-21T13:38:28.0528999Z     ) -> Cursor[Row]:
2025-08-21T13:38:28.0529385Z         """Execute a query and return a cursor to read its results."""
2025-08-21T13:38:28.0529836Z         try:
2025-08-21T13:38:28.0530100Z             cur = self.cursor()
2025-08-21T13:38:28.0530411Z             if binary:
2025-08-21T13:38:28.0530699Z                 cur.format = BINARY
2025-08-21T13:38:28.0531017Z     
2025-08-21T13:38:28.0531328Z             return cur.execute(query, params, prepare=prepare)
2025-08-21T13:38:28.0531798Z         except e._NO_TRACEBACK as ex:
2025-08-21T13:38:28.0532199Z >           raise ex.with_traceback(None)
2025-08-21T13:38:28.0533041Z E           psycopg.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block
2025-08-21T13:38:28.0533792Z 
2025-08-21T13:38:28.0534601Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/psycopg/connection.py:257: InFailedSqlTransaction
2025-08-21T13:38:28.0535553Z =========================== short test summary info ============================
2025-08-21T13:38:28.0537357Z FAILED tests/test_smoke.py::test_semantic_search_fallback - psycopg.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block
2025-08-21T13:38:28.0538590Z 1 failed, 5 passed in 11.33s
2025-08-21T13:38:29.0528698Z ##[error]Process completed with exit code 1.
