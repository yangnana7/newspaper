# 作業ログ 2025-08-26

## 目的
- エンティティリンクとイベント抽出の初期実装
- ランキングの言語信頼度（language_trust）拡張
- CI・テストはDB依存を避けた形で通す

## 追加/更新ファイル
- エンティティ
  - 追加: `scripts/ingest_entities.py`
  - 更新: `scripts/entity_link.py`（spaCy利用時はNER、未導入時は正規表現フォールバック）
  - テスト: `tests/test_entity_extraction.py`
- イベント
  - 追加: `scripts/ingest_events.py`
  - 更新: `scripts/event_extract.py`（日付表現抽出の簡易実装）
  - テスト: `tests/test_event_extraction.py`
- ランキング
  - 更新: `config/ranking.yaml`（language_trust追加・weightsにlanguageキー）
  - 更新: `search/ranker.py`（language_trust読込・weight正規化・rerank_candidates拡張）
  - 更新: `mcp_news/server.py`, `web/app.py`（SELECTに`d.lang`を追加し言語重みを反映）
  - テスト: `tests/test_ranking_config.py`（weights合計判定の一般化）、`tests/test_language_trust.py`

## メモ
- 固定ポリシー（DB: newshub、127.0.0.1:3011、cosine、UI既定無効）は維持
- CIではDBを起動しないため、DB依存の統合試験はスキップ制御（`SKIP_DB_TESTS=1`）

## 実行のヒント（運用）
- エンティティ登録: `python -m scripts.ingest_entities`
- イベント登録: `python -m scripts.ingest_events`
- 言語信頼度は `config/ranking.yaml` の `language_trust` を編集して運用調整

