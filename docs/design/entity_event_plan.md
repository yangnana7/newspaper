# エンティティリンク／イベント抽出 設計メモ（素案）

## 方針概要
- ステップ1: 固有表現抽出（人・組織・地名）→ surface form を `entity` に集約
- ステップ2: 外部IDリンク（Wikidata等）→ `entity.ext_id` を付与
- ステップ3: 事象抽出（type_id設計）→ `event` と `event_participant` に登録

## 外部IDの扱い
- `entity.ext_id`: 例 `Q42`（Wikidata）や `org:12345` のような名前空間付き表現を許容
- 名前正規化は後続タスク（同義語、別名対応）

### 外部IDリンクの信頼度判定（実装方針）
- Wikidata検索API `wbsearchentities` の応答から `match.type=exact` を高信頼（0.9）とし、その他は0.65、説明文に「曖昧さ回避」などのブラックリスト語が含まれる場合は減点。
- 閾値（例: 0.6）未満は `ext_id` を付与しない。
- 設定ファイル `config/linking.yaml` で `min_confidence`、`blacklist_keywords`、`requests_per_sec`、`max_retries`、`prefer_lang` を管理。
- 進捗ファイルに `ent_id` を追記して再実行時にスキップ（中断再開）。

## type_id の分類案
- 1000台: 会見/発表、1100台: 会談/会合、1200台: 災害、1300台: 裁判/判決 など
- 詳細は運用で合意の上、`event.type_id` を拡張

### キーワード分類（暫定実装）
- 1000: `記者会見`/`会見`/`発表`
- 1100: `会談`/`会合`/`首脳会談`
- 1200: `地震`/`台風`/`豪雨`/`災害`/`噴火`
- 1300: `裁判`/`判決`/`起訴`/`有罪`/`無罪`
- 既知外は `9999`

### 参加者ロール
- `participants` の各要素を `{name, role}` 形式で保持。現状ロールは `None` も許容し将来推定を導入。

### 場所抽出（暫定）
- 主要都市の辞書で単純マッチし geohash を付与（例: 東京=`xn76`）。曖昧性は当面スキップ。

## 抽出ツール候補
- spaCy, Stanza（ローカル推論）
- OpenAI Responses/Batch（クラウド補助、要ガードレール）

## 今後の課題
- 日本語NERの精度検証
- ソース別信頼度とイベント確度の関連づけ
- UIとの連動（時系列表示、関係グラフ）
